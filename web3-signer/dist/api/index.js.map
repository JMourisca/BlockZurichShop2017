{"version":3,"sources":["../../src/api/index.js"],"names":["config","db","api","use","get","req","res","json","version","web3","providers","HttpProvider","address","key","merchant","blogOwner","siroop","Tx","require","privateKey","Buffer","console","log","eth","getTransactionCount","error","result","toString","rawTx","nonce","gasPrice","gasLimit","to","value","data","tx","sign","serializedTx","serialize","sendRawTransaction","err","hash"],"mappings":";;;;;;AAAA;;AACA;;AACA;;;;AACA;;;;;;kBAEe,gBAAoB;AAAA,KAAjBA,MAAiB,QAAjBA,MAAiB;AAAA,KAATC,EAAS,QAATA,EAAS;;AAClC,KAAIC,MAAM,sBAAV;;AAEA;AACAA,KAAIC,GAAJ,CAAQ,SAAR,EAAmB,sBAAO,EAAEH,cAAF,EAAUC,MAAV,EAAP,CAAnB;;AAEA;AACAC,KAAIE,GAAJ,CAAQ,GAAR,EAAa,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC1BA,MAAIC,IAAJ,CAAS,EAAEC,yBAAF,EAAT;AACA,EAFD;;AAKAN,KAAIE,GAAJ,CAAQ,iBAAR,EAA2B,UAACC,GAAD,EAAMC,GAAN,EAAc;;AAGxC,MAAIG,OAAO,kBACP,IAAI,cAAKC,SAAL,CAAeC,YAAnB,CAAgC,gDAAhC,CADO,CAAX;AAGA,MAAIC,UAAU,4CAAd;AACA,MAAIC,MAAM,kEAAV;;AAEA,MAAIC,WAAW,4CAAf;AACA,MAAIC,YAAY,4CAAhB;AACA,MAAIC,SAAS,4CAAb;;AAEA;;;;;;;;;;AAYA,MAAIC,KAAKC,QAAQ,eAAR,CAAT;AACA,MAAIC,aAAa,IAAIC,MAAJ,CAAWP,GAAX,EAAgB,KAAhB,CAAjB;AACAQ,UAAQC,GAAR;;AAGA;AACAb,OAAKc,GAAL,CAASC,mBAAT,CAA6BZ,OAA7B,EAAsC,UAASa,KAAT,EAAgBC,MAAhB,EAAwB;AAC7DL,WAAQC,GAAR,CAAYI,OAAOC,QAAP,CAAgB,EAAhB,CAAZ;AACA,OAAIC,QAAQ;AACVC,WAAO,OAAKH,OAAOC,QAAP,CAAgB,EAAhB,CADF;AAEVG,cAAU,cAFA;AAGVC,cAAU,SAHA;AAIVC,QAAI,4CAJM;AAKVC,WAAO,mBALG;AAMVC,UAAM;AANI,IAAZ;;AASA,OAAIC,KAAK,IAAIlB,EAAJ,CAAOW,KAAP,CAAT;AACAO,MAAGC,IAAH,CAAQjB,UAAR;;AAEA,OAAIkB,eAAeF,GAAGG,SAAH,EAAnB;AACA;AACAjB,WAAQC,GAAR,CAAY,cAAZ;AACAD,WAAQC,GAAR,CAAYe,aAAaV,QAAb,CAAsB,KAAtB,CAAZ;AACAU,kBAAe,OAAKA,aAAaV,QAAb,CAAsB,KAAtB,CAApB;;AAEA;AACAlB,QAAKc,GAAL,CAASgB,kBAAT,CAA4BF,aAAaV,QAAb,CAAsB,KAAtB,CAA5B,EAA0D,UAASa,GAAT,EAAcC,IAAd,EAAoB;AAC5E,QAAI,CAACD,GAAL,EACEnB,QAAQC,GAAR,CAAYmB,IAAZ;AACHnC,QAAIC,IAAJ,CAASkC,IAAT;AACA,IAJD;AAKA,GA1BD;;AA4BA;;;AAGA;AACA,EA/DD;;AAiEA,QAAOvC,GAAP;AACA,C","file":"index.js","sourcesContent":["import { version } from '../../package.json';\nimport { Router } from 'express';\nimport facets from './facets';\nimport Web3 from 'web3';\n\nexport default ({ config, db }) => {\n\tlet api = Router();\n\n\t// mount the facets resource\n\tapi.use('/facets', facets({ config, db }));\n\n\t// perhaps expose some API metadata at the root\n\tapi.get('/', (req, res) => {\n\t\tres.json({ version });\n\t});\n\n\n\tapi.get('/do_transaction', (req, res) => {\n\n\t\n\t\tvar web3 = new Web3(\n\t\t    new Web3.providers.HttpProvider('https://rinkeby.infura.io/cPqmhj9ZK2EWjKRq3FUG')\n\t\t);\n\t\tvar address = '0xc51fb6b35bc1534373aedee98dea0f153acc3ae9';\n\t\tvar key = '2653534f4b92cfea6ff14d13080e87b95eff99594ae9bebf4ccc0e81eee5f18e';\n\n\t\tvar merchant = \"0x9838ECaa5D49a01e1B6e13bA07bDc87a6AEBab92\";\n\t\tvar blogOwner = \"0x2a86D62A7e5860a275A2ace8bfe3141dC7EE907D\";\n\t\tvar siroop = \"0xCeCfF1AD5dfbA6C12AB1c3D45549609F028B97Dd\";\n\n\t\t/*\n\t\tconsole.log(web3);\n\n\t\tvar smartBuyer = new web3.eth.Contract([{\"constant\":false,\"inputs\":[{\"name\":\"_merchant\",\"type\":\"address\"},{\"name\":\"_category\",\"type\":\"bool\"},{\"name\":\"_maxOrder\",\"type\":\"uint256\"},{\"name\":\"_amountStock\",\"type\":\"uint256\"}],\"name\":\"addProduct\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_orderID\",\"type\":\"uint256\"}],\"name\":\"returnArrived\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"austrianPost\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"blogOwners\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"electronicProducts\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_productID\",\"type\":\"uint256\"},{\"name\":\"_merchant\",\"type\":\"address\"},{\"name\":\"_blogOwner\",\"type\":\"address\"},{\"name\":\"isSiroop\",\"type\":\"bool\"},{\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"doPurchase\",\"outputs\":[{\"name\":\"result\",\"type\":\"bool\"}],\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"siroop\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"productStock\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"productMaxOrders\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"products\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_orderID\",\"type\":\"uint256\"}],\"name\":\"productDelivered\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_merchant\",\"type\":\"address\"}],\"name\":\"addMerchant\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_siroop\",\"type\":\"address\"}],\"name\":\"changeSiroop\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"_blogOwner\",\"type\":\"address\"}],\"name\":\"addBlogOwner\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"merchants\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"transferOwnership\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"payable\":true,\"stateMutability\":\"payable\",\"type\":\"fallback\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"previousOwner\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"OwnershipTransferred\",\"type\":\"event\"}]);\n\t\tsmartBuyer.options.address = '0x76e9abef06dfcd3b862234ccfc5030fd8ba231d7';\n\n\t\tvar x = smartBuyer.methods.doPurchase(0, merchant, blogOwner, true, 2).send({from: '0xc51fb6b35bc1534373aedee98dea0f153acc3ae9'})\n\t\t.then(function(receipt){\n\t\t    console.log(receipt);\n\t\t});\n\t\t*/\n\n\t\tvar Tx = require('ethereumjs-tx');\n\t\tvar privateKey = new Buffer(key, 'hex');\n\t\tconsole.log();\n\n\n\t\t// Get current nonce\n\t\tweb3.eth.getTransactionCount(address, function(error, result) {\n\t\t\tconsole.log(result.toString(16));\n\t\t\tvar rawTx = {\n\t\t\t  nonce: '0x'+result.toString(16),\n\t\t\t  gasPrice: '0x174876E800', \n\t\t\t  gasLimit: '0x3D090',\n\t\t\t  to: '0x76e9abef06dfcd3b862234ccfc5030fd8ba231d7', \n\t\t\t  value: '0x16345785D8A0000', \n\t\t\t  data: '0x46e9b66100000000000000000000000000000000000000000000000000000000000000000000000000000000000000009838ecaa5d49a01e1b6e13ba07bdc87a6aebab920000000000000000000000002a86d62a7e5860a275a2ace8bfe3141dc7ee907d00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002'\n\t\t\t}\n\n\t\t\tvar tx = new Tx(rawTx)\n\t\t\ttx.sign(privateKey)\n\n\t\t\tvar serializedTx = tx.serialize();\n\t\t\t//serializedTx = parseInt(serializedTx).toString(16);\n\t\t\tconsole.log('serializedTx');\n\t\t\tconsole.log(serializedTx.toString('hex'));\n\t\t\tserializedTx = '0x'+serializedTx.toString('hex');\n\n\t\t\t// send transaction\n\t\t\tweb3.eth.sendRawTransaction(serializedTx.toString('hex'), function(err, hash) {\n\t\t\t  if (!err)\n\t\t\t    console.log(hash);\n\t\t\t\tres.json(hash);\n\t\t\t});\n\t\t});\n\n\t\t//web3.eth.sendRaw()\n\n\n\t\t//res.json(true);\n\t});\n\n\treturn api;\n}\n"]}